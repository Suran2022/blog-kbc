# 博客项目初始化脚本

本文档提供了博客项目的初始化脚本，包括前端和后端的项目创建、依赖安装和基础配置。通过执行这些脚本，可以快速搭建起博客项目的基础框架。

## 一、前端项目初始化

### 1.1 创建Vue项目

```bash
# 确保已安装最新版的Node.js和npm
node -v
npm -v

# 安装Vue CLI（如果尚未安装）
npm install -g @vue/cli

# 创建项目
vue create blog-frontend

# 选择Vue 3配置
# 1. 手动选择特性 (Manually select features)
# 2. 选择：Babel, Router, Vuex, CSS Pre-processors, Linter
# 3. 选择Vue版本：3.x
# 4. 选择路由模式：history mode
# 5. 选择CSS预处理器：SCSS/SASS
# 6. 选择ESLint配置：ESLint + Prettier
# 7. 选择Lint时机：Lint on save
# 8. 选择配置文件存放位置：In dedicated config files

# 进入项目目录
cd blog-frontend
```

### 1.2 安装依赖

```bash
# 安装Element Plus
npm install element-plus

# 安装图标库
npm install @element-plus/icons-vue

# 安装axios用于HTTP请求
npm install axios

# 安装富文本编辑器
npm install @wangeditor/editor @wangeditor/editor-for-vue

# 安装dayjs处理日期
npm install dayjs

# 安装lodash工具库
npm install lodash

# 安装nprogress进度条
npm install nprogress
```

### 1.3 配置项目

#### 1.3.1 创建环境配置文件

创建 `.env.development` 文件：

```
VUE_APP_BASE_API=/api
VUE_APP_MOCK=false
```

创建 `.env.production` 文件：

```
VUE_APP_BASE_API=/api
VUE_APP_MOCK=false
```

#### 1.3.2 配置axios

创建 `src/utils/request.js` 文件：

```javascript
import axios from 'axios'
import { ElMessage } from 'element-plus'
import store from '@/store'
import router from '@/router'

// 创建axios实例
const service = axios.create({
  baseURL: process.env.VUE_APP_BASE_API,
  timeout: 10000
})

// 请求拦截器
service.interceptors.request.use(
  config => {
    // 添加token
    const token = store.getters.token
    if (token) {
      config.headers['Authorization'] = 'Bearer ' + token
    }
    return config
  },
  error => {
    console.log(error)
    return Promise.reject(error)
  }
)

// 响应拦截器
service.interceptors.response.use(
  response => {
    const res = response.data
    // 如果返回的状态码不是200，说明接口有问题，直接抛出错误
    if (res.code !== 200) {
      ElMessage({
        message: res.message || '系统错误',
        type: 'error',
        duration: 5 * 1000
      })

      // 401: 未登录或token过期
      if (res.code === 401) {
        // 重新登录
        store.dispatch('user/resetToken').then(() => {
          router.push({ path: '/admin/login' })
        })
      }
      return Promise.reject(new Error(res.message || '系统错误'))
    } else {
      return res
    }
  },
  error => {
    console.log('err' + error)
    ElMessage({
      message: error.message || '请求错误',
      type: 'error',
      duration: 5 * 1000
    })
    return Promise.reject(error)
  }
)

export default service
```

#### 1.3.3 配置路由守卫

修改 `src/router/index.js` 文件：

```javascript
import { createRouter, createWebHistory } from 'vue-router'
import store from '@/store'
import NProgress from 'nprogress'
import 'nprogress/nprogress.css'

// 路由配置
const routes = [
  {
    path: '/',
    component: () => import('@/layouts/FrontLayout'),
    children: [
      {
        path: '',
        name: 'Home',
        component: () => import('@/views/front/Home'),
        meta: { title: '首页' }
      },
      {
        path: 'article/:id',
        name: 'ArticleDetail',
        component: () => import('@/views/front/ArticleDetail'),
        meta: { title: '文章详情' }
      },
      {
        path: 'search',
        name: 'SearchResult',
        component: () => import('@/views/front/SearchResult'),
        meta: { title: '搜索结果' }
      },
      {
        path: 'category/:id',
        name: 'CategoryArticles',
        component: () => import('@/views/front/CategoryArticles'),
        meta: { title: '分类文章' }
      }
    ]
  },
  {
    path: '/admin/login',
    name: 'Login',
    component: () => import('@/views/admin/Login'),
    meta: { title: '登录' }
  },
  {
    path: '/admin',
    component: () => import('@/layouts/AdminLayout'),
    redirect: '/admin/dashboard',
    meta: { requiresAuth: true },
    children: [
      {
        path: 'dashboard',
        name: 'Dashboard',
        component: () => import('@/views/admin/Dashboard'),
        meta: { title: '控制台', requiresAuth: true }
      },
      {
        path: 'articles',
        name: 'ArticleManage',
        component: () => import('@/views/admin/ArticleManage'),
        meta: { title: '文章管理', requiresAuth: true }
      },
      {
        path: 'articles/edit/:id?',
        name: 'ArticleEdit',
        component: () => import('@/views/admin/ArticleEdit'),
        meta: { title: '编辑文章', requiresAuth: true }
      },
      {
        path: 'categories',
        name: 'CategoryManage',
        component: () => import('@/views/admin/CategoryManage'),
        meta: { title: '分类管理', requiresAuth: true }
      },
      {
        path: 'settings',
        name: 'SystemSetting',
        component: () => import('@/views/admin/SystemSetting'),
        meta: { title: '系统设置', requiresAuth: true }
      }
    ]
  },
  {
    path: '/:pathMatch(.*)*',
    name: 'NotFound',
    component: () => import('@/views/NotFound'),
    meta: { title: '页面不存在' }
  }
]

const router = createRouter({
  history: createWebHistory(process.env.BASE_URL),
  routes
})

// 进度条配置
NProgress.configure({ showSpinner: false })

// 路由守卫
router.beforeEach(async (to, from, next) => {
  // 开始进度条
  NProgress.start()
  
  // 设置页面标题
  document.title = to.meta.title ? `${to.meta.title} - 博客系统` : '博客系统'
  
  // 判断是否需要登录权限
  if (to.matched.some(record => record.meta.requiresAuth)) {
    // 判断是否已登录
    if (!store.getters.token) {
      // 未登录，跳转到登录页
      next({
        path: '/admin/login',
        query: { redirect: to.fullPath }
      })
      NProgress.done()
    } else {
      // 已登录，获取用户信息
      if (!store.getters.hasUserInfo) {
        try {
          // 获取用户信息
          await store.dispatch('user/getUserInfo')
          next()
        } catch (error) {
          // 获取用户信息失败，清除token并跳转到登录页
          await store.dispatch('user/resetToken')
          next(`/admin/login?redirect=${to.fullPath}`)
          NProgress.done()
        }
      } else {
        next()
      }
    }
  } else {
    // 不需要登录权限
    next()
  }
})

router.afterEach(() => {
  // 结束进度条
  NProgress.done()
})

export default router
```

#### 1.3.4 配置Vuex

修改 `src/store/index.js` 文件：

```javascript
import { createStore } from 'vuex'
import user from './modules/user'
import article from './modules/article'
import category from './modules/category'
import setting from './modules/setting'

export default createStore({
  modules: {
    user,
    article,
    category,
    setting
  },
  getters: {
    token: state => state.user.token,
    userInfo: state => state.user.userInfo,
    hasUserInfo: state => JSON.stringify(state.user.userInfo) !== '{}',
    categories: state => state.category.categories,
    settings: state => state.setting.settings
  }
})
```

创建 `src/store/modules/user.js` 文件：

```javascript
import { login, getUserInfo, logout } from '@/api/auth'

const state = {
  token: localStorage.getItem('token') || '',
  userInfo: JSON.parse(localStorage.getItem('userInfo') || '{}')
}

const mutations = {
  SET_TOKEN(state, token) {
    state.token = token
    localStorage.setItem('token', token)
  },
  SET_USER_INFO(state, userInfo) {
    state.userInfo = userInfo
    localStorage.setItem('userInfo', JSON.stringify(userInfo))
  },
  RESET_STATE(state) {
    state.token = ''
    state.userInfo = {}
    localStorage.removeItem('token')
    localStorage.removeItem('userInfo')
  }
}

const actions = {
  // 登录
  async login({ commit }, loginForm) {
    try {
      const { data } = await login(loginForm)
      commit('SET_TOKEN', data.token)
      commit('SET_USER_INFO', data.userInfo)
      return data
    } catch (error) {
      console.error('登录失败:', error)
      throw error
    }
  },
  // 获取用户信息
  async getUserInfo({ commit }) {
    try {
      const { data } = await getUserInfo()
      commit('SET_USER_INFO', data)
      return data
    } catch (error) {
      console.error('获取用户信息失败:', error)
      throw error
    }
  },
  // 退出登录
  async logout({ commit }) {
    try {
      await logout()
      commit('RESET_STATE')
    } catch (error) {
      console.error('退出登录失败:', error)
      throw error
    }
  },
  // 重置token
  resetToken({ commit }) {
    commit('RESET_STATE')
  }
}

export default {
  namespaced: true,
  state,
  mutations,
  actions
}
```

### 1.4 创建API接口文件

创建 `src/api/auth.js` 文件：

```javascript
import request from '@/utils/request'

// 登录
export function login(data) {
  return request({
    url: '/auth/login',
    method: 'post',
    data
  })
}

// 获取用户信息
export function getUserInfo() {
  return request({
    url: '/auth/info',
    method: 'get'
  })
}

// 退出登录
export function logout() {
  return request({
    url: '/auth/logout',
    method: 'post'
  })
}
```

创建 `src/api/article.js` 文件：

```javascript
import request from '@/utils/request'

// 获取文章列表（前台）
export function getArticles(params) {
  return request({
    url: '/articles',
    method: 'get',
    params
  })
}

// 获取文章详情（前台）
export function getArticleById(id) {
  return request({
    url: `/articles/${id}`,
    method: 'get'
  })
}

// 搜索文章（前台）
export function searchArticles(params) {
  return request({
    url: '/articles/search',
    method: 'get',
    params
  })
}

// 获取最新文章列表（前台）
export function getLatestArticles(limit) {
  return request({
    url: '/articles/latest',
    method: 'get',
    params: { limit }
  })
}

// 获取文章列表（后台）
export function getAdminArticles(params) {
  return request({
    url: '/admin/articles',
    method: 'get',
    params
  })
}

// 获取文章详情（后台）
export function getAdminArticleById(id) {
  return request({
    url: `/admin/articles/${id}`,
    method: 'get'
  })
}

// 创建文章
export function createArticle(data) {
  return request({
    url: '/admin/articles',
    method: 'post',
    data
  })
}

// 更新文章
export function updateArticle(id, data) {
  return request({
    url: `/admin/articles/${id}`,
    method: 'put',
    data
  })
}

// 删除文章
export function deleteArticle(id) {
  return request({
    url: `/admin/articles/${id}`,
    method: 'delete'
  })
}
```

## 二、后端项目初始化

### 2.1 创建Spring Boot项目

使用Spring Initializr创建项目：https://start.spring.io/

- Project: Maven
- Language: Java
- Spring Boot: 2.7.x
- Group: com.example
- Artifact: blog-backend
- Name: blog-backend
- Description: Blog Backend System
- Package name: com.example.blog
- Packaging: Jar
- Java: 11

依赖项：
- Spring Web
- Spring Data JPA
- MySQL Driver
- Lombok
- Spring Security
- Validation
- Spring Boot DevTools

下载并解压项目，然后导入到IDE中。

### 2.2 配置数据库连接

修改 `src/main/resources/application.yml` 文件：

```yaml
server:
  port: 8080

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/blog?useUnicode=true&characterEncoding=utf-8&serverTimezone=Asia/Shanghai
    username: root
    password: root
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.MySQL8Dialect
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8

# JWT配置
jwt:
  # JWT加密密钥
  secret: your-secret-key
  # token有效期（单位：秒）
  expiration: 86400

# 文件上传配置
upload:
  # 上传路径
  path: /upload/
  # 允许的文件类型
  allowed-types: jpg,jpeg,png,gif
  # 最大文件大小（单位：MB）
  max-size: 5
```

### 2.3 添加依赖

修改 `pom.xml` 文件，添加以下依赖：

```xml
<!-- JWT依赖 -->
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-api</artifactId>
    <version>0.11.5</version>
</dependency>
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-impl</artifactId>
    <version>0.11.5</version>
    <scope>runtime</scope>
</dependency>
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-jackson</artifactId>
    <version>0.11.5</version>
    <scope>runtime</scope>
</dependency>

<!-- Swagger依赖 -->
<dependency>
    <groupId>io.springfox</groupId>
    <artifactId>springfox-boot-starter</artifactId>
    <version>3.0.0</version>
</dependency>

<!-- Commons IO -->
<dependency>
    <groupId>commons-io</groupId>
    <artifactId>commons-io</artifactId>
    <version>2.11.0</version>
</dependency>

<!-- Commons Lang -->
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-lang3</artifactId>
    <version>3.12.0</version>
</dependency>
```

### 2.4 创建基础包结构

```
src/main/java/com/example/blog/
├── config/           # 配置类
├── controller/       # 控制器
│   ├── admin/        # 后台控制器
│   └── front/        # 前台控制器
├── dto/              # 数据传输对象
│   ├── request/      # 请求DTO
│   └── response/     # 响应DTO
├── entity/           # 实体类
├── exception/        # 异常处理
├── repository/       # 数据访问层
├── security/         # 安全相关
├── service/          # 服务层
│   └── impl/         # 服务实现
└── util/             # 工具类
```

### 2.5 创建通用响应类

创建 `src/main/java/com/example/blog/dto/response/Result.java` 文件：

```java
package com.example.blog.dto.response;

import lombok.Data;

@Data
public class Result<T> {
    private Integer code;
    private String message;
    private T data;

    public static <T> Result<T> success() {
        return success(null);
    }

    public static <T> Result<T> success(T data) {
        Result<T> result = new Result<>();
        result.setCode(200);
        result.setMessage("成功");
        result.setData(data);
        return result;
    }

    public static <T> Result<T> error(Integer code, String message) {
        Result<T> result = new Result<>();
        result.setCode(code);
        result.setMessage(message);
        return result;
    }
}
```

### 2.6 创建JWT工具类

创建 `src/main/java/com/example/blog/util/JwtUtil.java` 文件：

```java
package com.example.blog.util;

import io.jsonwebtoken.Claims;
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;
import io.jsonwebtoken.security.Keys;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.stereotype.Component;

import java.security.Key;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;
import java.util.function.Function;

@Component
public class JwtUtil {

    @Value("${jwt.secret}")
    private String secret;

    @Value("${jwt.expiration}")
    private Long expiration;

    // 生成密钥
    private Key getSigningKey() {
        byte[] keyBytes = secret.getBytes();
        return Keys.hmacShaKeyFor(keyBytes);
    }

    // 从token中提取用户名
    public String extractUsername(String token) {
        return extractClaim(token, Claims::getSubject);
    }

    // 从token中提取过期时间
    public Date extractExpiration(String token) {
        return extractClaim(token, Claims::getExpiration);
    }

    // 从token中提取claim
    public <T> T extractClaim(String token, Function<Claims, T> claimsResolver) {
        final Claims claims = extractAllClaims(token);
        return claimsResolver.apply(claims);
    }

    // 解析token
    private Claims extractAllClaims(String token) {
        return Jwts.parserBuilder()
                .setSigningKey(getSigningKey())
                .build()
                .parseClaimsJws(token)
                .getBody();
    }

    // 检查token是否过期
    private Boolean isTokenExpired(String token) {
        return extractExpiration(token).before(new Date());
    }

    // 生成token
    public String generateToken(UserDetails userDetails) {
        Map<String, Object> claims = new HashMap<>();
        return createToken(claims, userDetails.getUsername());
    }

    // 创建token
    private String createToken(Map<String, Object> claims, String subject) {
        return Jwts.builder()
                .setClaims(claims)
                .setSubject(subject)
                .setIssuedAt(new Date(System.currentTimeMillis()))
                .setExpiration(new Date(System.currentTimeMillis() + expiration * 1000))
                .signWith(getSigningKey(), SignatureAlgorithm.HS256)
                .compact();
    }

    // 验证token
    public Boolean validateToken(String token, UserDetails userDetails) {
        final String username = extractUsername(token);
        return (username.equals(userDetails.getUsername()) && !isTokenExpired(token));
    }
}
```

### 2.7 配置Spring Security

创建 `src/main/java/com/example/blog/config/SecurityConfig.java` 文件：

```java
package com.example.blog.config;

import com.example.blog.security.JwtAuthenticationEntryPoint;
import com.example.blog.security.JwtAuthenticationFilter;
import com.example.blog.service.impl.UserDetailsServiceImpl;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.CorsConfigurationSource;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;

import java.util.Arrays;

@Configuration
@EnableWebSecurity
@EnableGlobalMethodSecurity(prePostEnabled = true)
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Autowired
    private UserDetailsServiceImpl userDetailsService;

    @Autowired
    private JwtAuthenticationEntryPoint unauthorizedHandler;

    @Bean
    public JwtAuthenticationFilter jwtAuthenticationFilter() {
        return new JwtAuthenticationFilter();
    }

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsService).passwordEncoder(passwordEncoder());
    }

    @Bean
    @Override
    public AuthenticationManager authenticationManagerBean() throws Exception {
        return super.authenticationManagerBean();
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .cors().and().csrf().disable()
            .exceptionHandling().authenticationEntryPoint(unauthorizedHandler).and()
            .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS).and()
            .authorizeRequests()
            .antMatchers("/api/auth/login").permitAll()
            .antMatchers(HttpMethod.GET, "/api/articles/**").permitAll()
            .antMatchers(HttpMethod.GET, "/api/categories/**").permitAll()
            .antMatchers(HttpMethod.GET, "/api/contributors/**").permitAll()
            .antMatchers(HttpMethod.GET, "/api/settings/**").permitAll()
            .antMatchers("/swagger-ui/**", "/swagger-resources/**", "/v3/api-docs/**").permitAll()
            .anyRequest().authenticated();

        // 添加JWT过滤器
        http.addFilterBefore(jwtAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class);
    }

    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        configuration.setAllowedOrigins(Arrays.asList("*"));
        configuration.setAllowedMethods(Arrays.asList("GET", "POST", "PUT", "DELETE", "OPTIONS"));
        configuration.setAllowedHeaders(Arrays.asList("Authorization", "Content-Type", "X-Requested-With"));
        configuration.setExposedHeaders(Arrays.asList("Authorization"));
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", configuration);
        return source;
    }
}
```

### 2.8 创建JWT认证过滤器

创建 `src/main/java/com/example/blog/security/JwtAuthenticationFilter.java` 文件：

```java
package com.example.blog.security;

import com.example.blog.util.JwtUtil;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.web.authentication.WebAuthenticationDetailsSource;
import org.springframework.util.StringUtils;
import org.springframework.web.filter.OncePerRequestFilter;

import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class JwtAuthenticationFilter extends OncePerRequestFilter {

    @Autowired
    private JwtUtil jwtUtil;

    @Autowired
    private UserDetailsService userDetailsService;

    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
            throws ServletException, IOException {
        try {
            String jwt = getJwtFromRequest(request);

            if (StringUtils.hasText(jwt) && SecurityContextHolder.getContext().getAuthentication() == null) {
                String username = jwtUtil.extractUsername(jwt);

                if (StringUtils.hasText(username)) {
                    UserDetails userDetails = userDetailsService.loadUserByUsername(username);

                    if (jwtUtil.validateToken(jwt, userDetails)) {
                        UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(
                                userDetails, null, userDetails.getAuthorities());
                        authentication.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));
                        SecurityContextHolder.getContext().setAuthentication(authentication);
                    }
                }
            }
        } catch (Exception ex) {
            logger.error("Could not set user authentication in security context", ex);
        }

        filterChain.doFilter(request, response);
    }

    private String getJwtFromRequest(HttpServletRequest request) {
        String bearerToken = request.getHeader("Authorization");
        if (StringUtils.hasText(bearerToken) && bearerToken.startsWith("Bearer ")) {
            return bearerToken.substring(7);
        }
        return null;
    }
}
```

### 2.9 创建JWT认证入口点

创建 `src/main/java/com/example/blog/security/JwtAuthenticationEntryPoint.java` 文件：

```java
package com.example.blog.security;

import com.example.blog.dto.response.Result;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.http.MediaType;
import org.springframework.security.core.AuthenticationException;
import org.springframework.security.web.AuthenticationEntryPoint;
import org.springframework.stereotype.Component;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.PrintWriter;

@Component
public class JwtAuthenticationEntryPoint implements AuthenticationEntryPoint {

    @Override
    public void commence(HttpServletRequest request, HttpServletResponse response,
                         AuthenticationException authException) throws IOException, ServletException {
        response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
        response.setContentType(MediaType.APPLICATION_JSON_VALUE);

        Result<Object> result = Result.error(401, "未授权：" + authException.getMessage());
        ObjectMapper mapper = new ObjectMapper();
        PrintWriter writer = response.getWriter();
        writer.write(mapper.writeValueAsString(result));
        writer.flush();
        writer.close();
    }
}
```

### 2.10 创建全局异常处理

创建 `src/main/java/com/example/blog/exception/GlobalExceptionHandler.java` 文件：

```java
package com.example.blog.exception;

import com.example.blog.dto.response.Result;
import org.springframework.http.HttpStatus;
import org.springframework.security.access.AccessDeniedException;
import org.springframework.validation.BindingResult;
import org.springframework.validation.FieldError;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseStatus;
import org.springframework.web.bind.annotation.RestControllerAdvice;

import java.util.List;

@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(MethodArgumentNotValidException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public Result<Object> handleValidationExceptions(MethodArgumentNotValidException ex) {
        BindingResult bindingResult = ex.getBindingResult();
        List<FieldError> fieldErrors = bindingResult.getFieldErrors();
        StringBuilder builder = new StringBuilder("参数校验失败：");
        for (FieldError fieldError : fieldErrors) {
            builder.append(fieldError.getField())
                    .append("=")
                    .append(fieldError.getRejectedValue())
                    .append(", ")
                    .append(fieldError.getDefaultMessage())
                    .append("；");
        }
        return Result.error(400, builder.toString());
    }

    @ExceptionHandler(AccessDeniedException.class)
    @ResponseStatus(HttpStatus.FORBIDDEN)
    public Result<Object> handleAccessDeniedException(AccessDeniedException ex) {
        return Result.error(403, "禁止访问：" + ex.getMessage());
    }

    @ExceptionHandler(BusinessException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public Result<Object> handleBusinessException(BusinessException ex) {
        return Result.error(ex.getCode(), ex.getMessage());
    }

    @ExceptionHandler(Exception.class)
    @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)
    public Result<Object> handleException(Exception ex) {
        return Result.error(500, "服务器内部错误：" + ex.getMessage());
    }
}
```

### 2.11 创建业务异常类

创建 `src/main/java/com/example/blog/exception/BusinessException.java` 文件：

```java
package com.example.blog.exception;

import lombok.Getter;

@Getter
public class BusinessException extends RuntimeException {

    private final Integer code;

    public BusinessException(Integer code, String message) {
        super(message);
        this.code = code;
    }

    public static BusinessException of(Integer code, String message) {
        return new BusinessException(code, message);
    }
}
```

## 三、数据库初始化

### 3.1 创建数据库

```sql
CREATE DATABASE IF NOT EXISTS blog DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

USE blog;
```

### 3.2 创建用户表

```sql
CREATE TABLE IF NOT EXISTS `user` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL COMMENT '用户名',
  `password` varchar(100) NOT NULL COMMENT '密码',
  `nickname` varchar(50) NOT NULL COMMENT '昵称',
  `avatar` varchar(255) DEFAULT NULL COMMENT '头像',
  `email` varchar(100) DEFAULT NULL COMMENT '邮箱',
  `status` tinyint(4) NOT NULL DEFAULT '1' COMMENT '状态：0-禁用，1-正常',
  `create_time` datetime NOT NULL COMMENT '创建时间',
  `update_time` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

### 3.3 创建分类表

```sql
CREATE TABLE IF NOT EXISTS `category` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL COMMENT '分类名称',
  `create_time` datetime NOT NULL COMMENT '创建时间',
  `update_time` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='分类表';
```

### 3.4 创建文章表

```sql
CREATE TABLE IF NOT EXISTS `article` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `title` varchar(100) NOT NULL COMMENT '文章标题',
  `content` longtext NOT NULL COMMENT '文章内容',
  `summary` varchar(255) DEFAULT NULL COMMENT '文章摘要',
  `cover_image` varchar(255) DEFAULT NULL COMMENT '封面图片',
  `category_id` bigint(20) NOT NULL COMMENT '分类ID',
  `status` tinyint(4) NOT NULL DEFAULT '0' COMMENT '状态：0-草稿，1-已发布',
  `view_count` bigint(20) NOT NULL DEFAULT '0' COMMENT '浏览量',
  `create_time` datetime NOT NULL COMMENT '创建时间',
  `update_time` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_category_id` (`category_id`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='文章表';
```

### 3.5 创建贡献者表

```sql
CREATE TABLE IF NOT EXISTS `contributor` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL COMMENT '贡献者名称',
  `avatar` varchar(255) DEFAULT NULL COMMENT '头像',
  `description` varchar(255) DEFAULT NULL COMMENT '描述',
  `link` varchar(255) DEFAULT NULL COMMENT '链接',
  `create_time` datetime NOT NULL COMMENT '创建时间',
  `update_time` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='贡献者表';
```

### 3.6 创建系统设置表

```sql
CREATE TABLE IF NOT EXISTS `setting` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `site_name` varchar(50) NOT NULL COMMENT '站点名称',
  `logo` varchar(255) DEFAULT NULL COMMENT 'Logo',
  `description` varchar(255) DEFAULT NULL COMMENT '站点描述',
  `keywords` varchar(255) DEFAULT NULL COMMENT '关键词',
  `footer_info` varchar(255) DEFAULT NULL COMMENT '页脚信息',
  `create_time` datetime NOT NULL COMMENT '创建时间',
  `update_time` datetime NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统设置表';
```

### 3.7 初始化数据

```sql
-- 初始化管理员账号
INSERT INTO `user` (`username`, `password`, `nickname`, `avatar`, `email`, `status`, `create_time`, `update_time`)
VALUES ('admin', '$2a$10$X/XQFx.4SSAm5iBIsDQShuqE9zAJPQGJ0zMtRqjLqHVS.A.2jOKfq', '管理员', NULL, 'admin@example.com', 1, NOW(), NOW());

-- 初始化分类
INSERT INTO `category` (`name`, `create_time`, `update_time`)
VALUES ('技术', NOW(), NOW()),
       ('生活', NOW(), NOW()),
       ('资讯', NOW(), NOW());

-- 初始化系统设置
INSERT INTO `setting` (`site_name`, `logo`, `description`, `keywords`, `footer_info`, `create_time`, `update_time`)
VALUES ('我的博客', NULL, '一个简洁的博客系统', '博客,技术,生活', '© 2023 我的博客 All Rights Reserved.', NOW(), NOW());
```

## 四、项目启动

### 4.1 启动后端项目

```bash
# 进入后端项目目录
cd blog-backend

# 使用Maven启动项目
./mvnw spring-boot:run
```

### 4.2 启动前端项目

```bash
# 进入前端项目目录
cd blog-frontend

# 启动开发服务器
npm run serve
```

### 4.3 访问项目

- 前台页面：http://localhost:8080
- 后台页面：http://localhost:8080/admin/login
- API文档：http://localhost:8080/swagger-ui/index.html

## 五、注意事项

1. 确保MySQL服务已启动，并创建了名为`blog`的数据库
2. 默认管理员账号：admin，密码：admin123
3. 前端开发服务器默认运行在8080端口，如果与后端端口冲突，可以修改前端的`vue.config.js`文件，设置不同的端口
4. 文件上传路径需要确保有写入权限
5. JWT密钥应该在生产环境中更换为更复杂的值

## 六、常见问题解决

### 6.1 跨域问题

如果遇到跨域问题，可以检查后端的CORS配置是否正确。前端开发环境可以在`vue.config.js`中添加代理配置：

```javascript
module.exports = {
  devServer: {
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true
      }
    }
  }
}
```

### 6.2 数据库连接问题

如果无法连接到数据库，请检查：

1. MySQL服务是否启动
2. 数据库用户名和密码是否正确
3. 数据库名称是否正确
4. MySQL版本是否兼容

### 6.3 文件上传问题

如果文件上传失败，请检查：

1. 上传目录是否存在且有写入权限
2. 文件大小是否超过限制
3. 文件类型是否在允许范围内

### 6.4 JWT认证问题

如果JWT认证失败，请检查：

1. token是否正确传递
2. token是否过期
3. JWT密钥是否一致